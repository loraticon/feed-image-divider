<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Notion Image Widget</n  ><style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
    #controls { display: flex; gap: 12px; margin-bottom: 16px; }
    #controls button { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; color: #fff; }
    #addBtn { background: #007BFF; }
    .bg-btn { background: #6c757d; }
    .bg-btn.active { background: #343a40; }
    #downloadBtn { background: #28A745; }
    #clearBtn { background: #DC3545; }
    .grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; }
    .slot { position: relative; width: 100%; padding-top: 100%; border-radius: 12px; overflow: hidden; background: #eee; cursor: pointer; }
    .slot img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; object-position: center; }
    .plus { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); font-size: 48px; color: #aaa; pointer-events: none; }
  </style>
</head>
<body>
  <div id="controls">
    <button id="addBtn">이미지 추가</button>
    <button class="bg-btn active" data-color="#ffffff">라이트</button>
    <button class="bg-btn" data-color="#191919">다크</button>
    <button id="downloadBtn">다운로드 (원본 크기)</button>
    <button id="clearBtn">전체 비우기</button>
  </div>
  <div class="grid" id="grid"></div>
  <input type="file" id="fileInput" accept="image/*" multiple style="display:none;" />

  <!-- 캡처 라이브러리 -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
  (function() {
    const MAX_IMAGES = 8;
    let images = [];
    let bgColor = '#ffffff';

    const grid = document.getElementById('grid');
    const fileInput = document.getElementById('fileInput');
    const addBtn = document.getElementById('addBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const clearBtn = document.getElementById('clearBtn');
    const bgBtns = document.querySelectorAll('.bg-btn');

    function renderGrid() {
      grid.innerHTML = '';
      images.forEach(src => {
        const slot = document.createElement('div'); slot.className = 'slot';
        const img = document.createElement('img'); img.src = src;
        slot.appendChild(img);
        grid.appendChild(slot);
      });
      if (images.length < MAX_IMAGES) {
        const plusSlot = document.createElement('div'); plusSlot.className = 'slot plus';
        plusSlot.addEventListener('click', () => fileInput.click());
        grid.appendChild(plusSlot);
      }
    }

    fileInput.addEventListener('change', e => {
      Array.from(e.target.files)
        .slice(0, MAX_IMAGES - images.length)
        .forEach(file => images.push(URL.createObjectURL(file)));
      fileInput.value = '';
      renderGrid();
    });

    addBtn.addEventListener('click', () => fileInput.click());
    clearBtn.addEventListener('click', () => {
      if (confirm('정말 모두 삭제하시겠습니까?')) {
        images = [];
        renderGrid();
      }
    });

    bgBtns.forEach(btn => btn.addEventListener('click', () => {
      bgBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      bgColor = btn.dataset.color;
    }));

    downloadBtn.addEventListener('click', () => {
      if (!images.length) return alert('먼저 이미지를 추가해주세요.');
      const popup = window.open('', '_blank');
      const size = 300;
      const html = `<!DOCTYPE html>
<html lang="ko">
<head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>캡처 중...</title>
<style>*{margin:0;padding:0;box-sizing:border-box;}body{padding:20px;background:${bgColor};}
.grid{display:grid;grid-template-columns:repeat(4,${size}px);gap:8px;}
.slot{position:relative;width:${size}px;padding-top:${size}px;border-radius:12px;overflow:hidden;background:#eee;}
.slot img{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:contain;object-position:center;}
</style></head>
<body>
<div class="grid">
${images.map(src => `<div class="slot"><img src="${src}"/></div>`).join('')}
</div>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"><\/script>
<script>
window.onload = function() {
  html2canvas(document.querySelector('.grid'),{scale:window.devicePixelRatio||2}).then(canvas=>{
    canvas.toBlob(blob=>{
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'notion-widget.png';
      a.click();
      window.close();
    },'image/png');
  }).catch(e=>{console.error(e);window.close();});
};
<\/script>
</body>
</html>`;
      popup.document.write(html);
      popup.document.close();
    });

    renderGrid();
  })();
  </script>
</body>
</html>
